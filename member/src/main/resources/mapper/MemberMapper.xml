<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.armylife.member.mapper.MemberMapper" >
  <resultMap id="BaseResultMap" type="cn.armylife.common.domain.Member" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->

    <result column="member_id" jdbcType="BIGINT" property="memberId" />
    <result column="member_type" jdbcType="VARCHAR" property="memberType" />
    <result column="member_idcard" jdbcType="VARCHAR" property="memberIdcard" />
    <result column="member_wechat" jdbcType="VARCHAR" property="memberWechat" />
    <result column="member_wechat_token" jdbcType="VARCHAR" property="memberWechatToken" />
    <result column="member_alinumber" jdbcType="VARCHAR" property="memberAlinumber" />
    <result column="member_ali_token" jdbcType="VARCHAR" property="memberAliToken" />
    <result column="member_avatar" jdbcType="VARCHAR" property="memberAvatar" />
    <result column="member_name" jdbcType="VARCHAR" property="memberName" />
    <result column="member_nickname" jdbcType="VARCHAR" property="memberNickname" />
    <result column="register_time" jdbcType="VARCHAR" property="registerTime" />
    <result column="lastlogin_time" jdbcType="VARCHAR" property="lastloginTime" />
    <result column="member_phone" jdbcType="VARCHAR" property="memberPhone" />
    <result column="member_total" jdbcType="DECIMAL" property="memberTotal" />
    <result column="member_status" jdbcType="INTEGER" property="memberStatus" />
    <result column="member_password" jdbcType="VARCHAR" property="memberPassword" />
    <result column="shop_status" jdbcType="INTEGER" property="shopStatus" />
    <result column="alid" jdbcType="INTEGER" property="alid" />
    <result column="shop_name" jdbcType="VARCHAR" property="shopName" />
    <result column="isHot" jdbcType="INTEGER" property="isHot" />
    <result column="isdeliver" jdbcType="INTEGER" property="isdeliver" />
  </resultMap>
  <resultMap id="ShopMap" type="cn.armylife.common.domain.Member" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->

    <result column="member_id" jdbcType="BIGINT" property="memberId" />
    <result column="member_type" jdbcType="VARCHAR" property="memberType" />
    <result column="member_idcard" jdbcType="VARCHAR" property="memberIdcard" />
    <result column="member_wechat" jdbcType="VARCHAR" property="memberWechat" />
    <result column="member_wechat_token" jdbcType="VARCHAR" property="memberWechatToken" />
    <result column="member_alinumber" jdbcType="VARCHAR" property="memberAlinumber" />
    <result column="member_ali_token" jdbcType="VARCHAR" property="memberAliToken" />
    <result column="member_avatar" jdbcType="VARCHAR" property="memberAvatar" />
    <result column="member_name" jdbcType="VARCHAR" property="memberName" />
    <result column="member_nickname" jdbcType="VARCHAR" property="memberNickname" />
    <result column="register_time" jdbcType="VARCHAR" property="registerTime" />
    <result column="lastlogin_time" jdbcType="VARCHAR" property="lastloginTime" />
    <result column="member_phone" jdbcType="VARCHAR" property="memberPhone" />
    <result column="member_total" jdbcType="DECIMAL" property="memberTotal" />
    <result column="member_status" jdbcType="INTEGER" property="memberStatus" />
    <result column="member_password" jdbcType="VARCHAR" property="memberPassword" />
    <result column="shop_status" jdbcType="INTEGER" property="shopStatus" />
    <result column="alid" jdbcType="INTEGER" property="alid" />
    <result column="shop_name" jdbcType="VARCHAR" property="shopName" />
    <result column="isHot" jdbcType="INTEGER" property="isHot" />
    <result column="isdeliver" jdbcType="INTEGER" property="isdeliver" />
    <collection property="shopTag" ofType="cn.armylife.common.domain.ShopTag">
      <result column="shop_tag_id" jdbcType="BIGINT" property="shopTagId" />
      <result column="tag_name" jdbcType="VARCHAR" property="tagName" />
      <result column="shop_id" jdbcType="BIGINT" property="shopId" />
      <result column="creat_time" jdbcType="VARCHAR" property="creatTime" />
    </collection>
  </resultMap>
  <insert id="insert" parameterType="cn.armylife.common.domain.Member">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="memberId" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into member (member_type, member_idcard, member_wechat,
    member_wechat_token, member_alinumber, member_ali_token,
    member_avatar, member_name, member_nickname,
    register_time, lastlogin_time, member_phone,
    member_total, member_status, member_password,
    shop_status, alid, shop_name
    )
    values (#{memberType,jdbcType=VARCHAR}, #{memberIdcard,jdbcType=VARCHAR}, #{memberWechat,jdbcType=VARCHAR},
    #{memberWechatToken,jdbcType=VARCHAR}, #{memberAlinumber,jdbcType=VARCHAR}, #{memberAliToken,jdbcType=VARCHAR},
    #{memberAvatar,jdbcType=VARCHAR}, #{memberName,jdbcType=VARCHAR}, #{memberNickname,jdbcType=VARCHAR},
    #{registerTime,jdbcType=VARCHAR}, #{lastloginTime,jdbcType=VARCHAR}, #{memberPhone,jdbcType=VARCHAR},
    #{memberTotal,jdbcType=DECIMAL}, #{memberStatus,jdbcType=INTEGER}, #{memberPassword,jdbcType=VARCHAR},
    #{shopStatus,jdbcType=INTEGER}, #{alid,jdbcType=INTEGER}, #{shopName,jdbcType=VARCHAR}
    )
  </insert>


  <select id="loginUser" parameterType="cn.armylife.common.domain.Member" resultMap="BaseResultMap">
    select * from member where member_wechat=#{memberWechat} and member_type=#{memberType};
  </select>

  <select id="loginShop" parameterType="cn.armylife.common.domain.Member" resultMap="BaseResultMap">
    select * from member where member_phone=#{memberPhone} and member_type="3"
  </select>

  
  <select id="reloadSession" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select * from member where member_id=#{memberId}
  </select>

  <update id="updateMember">
    update member
    <set>
      <if test="memberIdcard!=null">
      member_idcard=#{memberIdcard},
      </if>
      <if test="memberWechat!=null">
        member_wechat=#{memberWechat},
      </if>
      <if test="memberAvatar!=null">
        member_avatar=#{memberAvatar},
      </if>
      <if test="memberName!=null">
        member_name=#{memberName},
      </if>
      <if test="memberNickname!=null">
        member_nickname=#{memberNickname},
      </if>
      <if test="lastloginTime!=null">
        lastlogin_time=#{lastloginTime},
      </if>
      <if test="memberPhone!=null">
        member_phone=#{memberPhone},
      </if>
      <if test="memberTotal!=null">
        member_total=#{memberTotal},
      </if>
      <if test="memberStatus!=null">
        member_status=#{memberStatus},
      </if>
      <if test="memberPassword!=null">
        member_password=#{memberPassword},
      </if>

      <if test="shopStatus!=null">
        shop_status=#{shopStatus},
      </if>
      <if test="shopName!=null">
        shop_name=#{shopName},
      </if>
      <if test="isHot!=null">
        isHot=#{isHot},
      </if>
     armylife=1 where member_id=#{memberId}
  </set>
  </update>
<!--  通过用户的memberWechat验证是否注册-->
  <select id="inspectMemberForOpenId" parameterType="cn.armylife.common.domain.Member" resultMap="BaseResultMap">
    select * from member where member_wechat=#{memberWechat} and member_type=#{memberType}
  </select>

  <!--  通过用户的phone验证是否注册-->
  <select id="inspectMemberForPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
    select * from member where member_phone=#{phone} and member_type=#{type}
  </select>

  <update id="updateDeliveryPhone">
    update member set member_phone=#{memberPhone} where member_id=#{memberId}
  </update>

  <select id="selectMemberforId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select * from member where member_id=#{memberId}
  </select>

  <select id="ShopNewForAppId" parameterType="java.lang.String" resultMap="ShopMap">
    select * from member m
    inner join shop_tag st on m.member_id=st.shop_id
    where alid=#{appId}
  </select>
  <update id="isdeliver">
    update member set isdeliver=#{total} where member_id=#{shopId}
  </update>
</mapper>